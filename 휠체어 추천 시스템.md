# 🧠 휠체어 추천 시스템 (Gradio UI)

자연어로 사용자의 상황(연령대, 성별, 체중, 사용 목적 등)을 입력하면, 규칙 기반 필터링을 통해 적합한 휠체어를 추천하고 텍스트/이미지로 보여주는 미니 앱입니다.

---

## 📌 목적 (Purpose)

- **자연어 → 구조화된 조건**으로 변환하여 제품 후보를 필터링
- **간단하고 빠른 추천**: 결과 요약 + 이미지 갤러리 제공
- **운영 편의성**: 이미지 파일명을 제품명과 일치시키면 자동 매칭

---

## 🧩 전체 흐름 (Flow)

1. **사용자 입력**: “70대 여성, 45kg, 외출용으로 가끔 사용”
2. **파싱**: `parse_user_input(message)` → `조건`(연령대/체중/용도/키워드 등)
3. **추천 필터링**: `filter_wheelchairs(조건)` → `결과_df`(pandas DataFrame)
4. **포맷팅**: 제품명/제조사/무게/좌폭/추천 키워드 정리
5. **이미지 매칭**: `get_image_path(제품명)` → `이미지/제품명.png`
6. **UI 출력**: 텍스트 요약 + 갤러리(Gradio Blocks)

---

## 🛠 주요 기능 (Features)

### 1) 자연어 파싱
- `parse_user_input(message)`  
  - 입력 문장에서 **연령대/성별/체중/사용 시나리오/선호 키워드**를 추출해 구조화된 `조건` 딕셔너리로 변환

### 2) 제품 필터링
- `filter_wheelchairs(조건)`  
  - 내부 제품 목록/CSV/DB에서 조건에 맞는 항목만 **스코어링/정렬**하여 `DataFrame` 반환  
  - (예시 컬럼) `제품명`, `제조사`, `무게(kg)`, `좌폭(cm)`, `추천 키워드1`, `추천 키워드2`

### 3) 이미지 매칭
- `get_image_path(product_name)`  
  - `이미지/제품명.png` 파일이 존재하면 경로 반환 (없으면 `None`)  
  - 운영 시 **이미지 폴더와 제품명 정합성**만 유지하면 자동 표시

### 4) Gradio UI
- **입력 박스**: 프리 텍스트로 요구사항 입력  
- **버튼**: “추천 받기”  
- **출력**: 텍스트 요약(여러 줄) + 이미지 갤러리(최대 3열)  
- **예시 입력**: 자주 쓰는 시나리오를 즉시 테스트 가능

---

## 📦 디렉터리 구조 (예시)
project-root/
├─ chatbot.py # Gradio 앱 진입점 (process_message, UI 정의)
├─ parser_filter.py # parse_user_input, filter_wheelchairs 구현부
├─ data/
│ └─ wheelchairs.csv # (선택) 제품 스펙 데이터
└─ 이미지/
├─ 제품A.png
├─ 제품B.png
└─ ...

> 이미지 파일명은 **제품명과 정확히 일치**해야 자동 매칭됩니다: `이미지/제품명.png`

---

## 🚀 실행 방법 (Getting Started)

### 1) 의존성 설치

\`\`\`bash
pip install gradio pandas
\`\`\`

### 2) 로컬 실행

\`\`\`bash
python chatbot.py
\`\`\`

- 콘솔에 출력되는 URL 접속  
- `demo.launch(share=True)` 설정으로 공유용 퍼블릭 링크도 자동 생성  

---

## 🧪 입출력 예시 (I/O Examples)

### 입력 (Input)

\`\`\`text
70대 여성이고 45kg이며 외출용으로 가끔 써요
\`\`\`

### 출력 (Output)

**텍스트**

\`\`\`text
1. 제품A (제조사X)
• 무게: 13kg
• 좌폭: 40cm
• 특징: 경량형, 외출용

2. 제품B (제조사Y)
• 무게: 14kg
• 좌폭: 42cm
• 특징: 차량탑재, 경량형
\`\`\`

**이미지**
- `이미지/제품A.png`, `이미지/제품B.png`가 있으면 갤러리에 함께 표시  

---

## 🔧 커스터마이즈 포인트

- **파싱 룰 강화**: `parser_filter.parse_user_input`에서 키워드/정규식/LLM 활용  
- **스코어링 로직**: `filter_wheelchairs`에 가중치(연령/체중/용도/키워드) 튜닝  
- **데이터 소스**: CSV → DB/API로 교체 가능  
- **UI/테마**: `gr.themes.Soft()` → 다른 테마 적용  

---

## ⚠️ 주의 / 알려진 이슈

- `process_message`의 반환 딕셔너리 키가 문자열로 감싸져 있지 않아 `NameError`가 발생할 수 있습니다. 아래처럼 문자열 키로 수정하세요.  

✅ 권장 수정 예시
\`\`\`python
return {
    "output_text": "\n\n".join(추천_결과),
    "output_gallery": 이미지_경로들,
}
\`\`\`

에러/예외 발생 시에도 동일하게:
\`\`\`python
return {
    "output_text": f"오류가 발생했습니다: {str(e)}",
    "output_gallery": [],
}
\`\`\`

- `parser_filter.py`가 필수입니다.  
  - `parse_user_input`, `filter_wheelchairs` 두 함수를 반드시 제공해야 합니다.  
- 이미지가 없으면 갤러리 칸은 비어 있을 수 있습니다 (정상 동작).  

---

## 🧾 라이선스
사내/개인 프로젝트에 맞는 라이선스를 `LICENSE`로 추가하세요.  

---

## ✍️ 참고 스니펫 (핵심 함수 개요)

\`\`\`python
def get_image_path(product_name):
    """
    제품명과 동일한 파일명을 이미지 폴더(기본: '이미지')에서 탐색.
    존재하면 경로 문자열, 없으면 None 반환.
    """
    ...

def process_message(message):
    """
    1) 사용자 자연어를 parse_user_input으로 구조화
    2) filter_wheelchairs로 후보 필터링(DataFrame)
    3) 결과를 텍스트로 요약 + 이미지 경로 매칭
    4) Gradio UI에 넘길 dict로 반환
    """
    ...
\`\`\`

---

## 🖥 UI 구성 요약 (Gradio Blocks)

- 제목/가이드: `gr.Markdown`  
- 입력: `gr.Textbox(lines=3)`  
- 버튼: `gr.Button("추천 받기")`  
- 출력: `gr.Textbox(lines=12)`, `gr.Gallery(columns=3, height=400)`  
- 예시: `gr.Examples([...], inputs=input_text)`  


